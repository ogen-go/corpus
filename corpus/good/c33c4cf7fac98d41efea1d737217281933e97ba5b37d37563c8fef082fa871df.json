{
	"File": {
		"__typename": "FileMatch",
		"repository": {
			"name": "github.com/ssdlc-education/identity-service"
		},
		"file": {
			"name": "api.yaml",
			"size": 0,
			"path": "backend/src/main/resources/api.yaml",
			"byteSize": 13505,
			"content": "openapi: 3.0.0\ninfo:\n  title: Identity Service\n  description: |\n    It's an service that allows you to create and manage account, and issue login credentials.\n    This file is the API spec written in OpenAPI. It's what the API may look like if it's really implemented as a RESTful\n    backend service. It's not actually used for now.\n  version: 0.1.0\nservers:\n  - url: http://api.example.com/v1\n    description: Production server\n  - url: http://staging-api.example.com/v1\n    description: Staging server\npaths:\n  /accounts:\n    post:\n      summary: Create an account.\n      description: |\n        Create an account, and issue cookie credential.\n        Initially, the account is in inactive state, user need to email verification to activate it.\n        The issued cookie will be returned with \"Set-Cookie\" header.\n      operationId: createAccount\n      requestBody:\n        content:\n          'application/json':\n            schema:\n              $ref: '#/components/schemas/Account'\n      responses:\n        '201':\n          description: The account is created successfully\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Account'\n        '400':\n          description: Invalid request.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n        '500':\n          description: Unknown error occurs.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n  /accounts/{id}:\n    parameters:\n      - name: \"id\"\n        in: \"path\"\n        schema:\n          type: string\n          minLength: 1\n        required: true\n    get:\n      summary: Get user's account.\n      description: |\n        It gets the user's account information.\n        If \"id\" is the special string \"@me\", it means the cookie credential will be used to determine the account to get.\n        If cookie credential is given, belongs to the same account as the owner of the account to get, then the following information\n        will be returned:\n        - username\n        - firstName\n        - lastName\n        - emails\n        - description\n\n        Otherwise, only the following information will be returned:\n        - username\n        - description\n      operationId: getAccount\n      responses:\n        '200':\n          description: Success.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Account'\n        '404':\n          description: Account not found\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n        '500':\n          description: Unknown error occurs.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n\n  /accounts/@me:\n    get:\n      summary: Get full profile info.\n      description: |\n        cookie credential will be used to determine the account to get.\n        If cookie credential is given, belongs to the same account as the owner of the account to get, then the following information\n        will be returned:\n        - username\n        - firstName\n        - lastName\n        - emails\n        - description\n      operationId: getOwnAccount\n      parameters:\n        - name: \"cookie\"\n          in: \"header\"\n          schema:\n            type: string\n          required: true\n      responses:\n        '200':\n          description: Success.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Account'\n        '401':\n          description: |\n            Invalid cookie credential is used.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n        '404':\n          description: Account not found\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n        '500':\n          description: Unknown error occurs.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n\n    put:\n      summary: Update an account.\n      description: |\n        Updates an account's information. The user's cookie credential must be carried.\n        The following fields can be updated:\n        - password\n        - description\n        - emails\n\n        If \"emails\" is carried, it will be merged with the existing emails. Only one email can be carried at a time.\n        If a duplicate one is found, 400 is returned.\n        An account can have at most two emails, and at least one, and at most one can be verified, at most one can be\n        unverified.\n        If an account already has one verified email, the new email will be appended with \"verified\" being false.\n        After the new email is verified, the new one will replace the old one, and there will be only one email.\n        If the account has only one unverified email, the new email will directly replace the old one.\n      operationId: updateAccount\n      parameters:\n        - name: \"token\"\n          in: \"query\"\n          schema:\n            type: string\n          required: true\n        - name: \"cookie\"\n          in: \"header\"\n          schema:\n            type: string\n          required: true\n      requestBody:\n        content:\n          'application/json':\n            schema:\n              $ref: '#/components/schemas/Account'\n      responses:\n        '204':\n          description: Successfully upate the account.\n        '400':\n          description: Invalid request.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n        '401':\n          description: |\n            Invalid cookie credential is used.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n        '404':\n          description: Account not found\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n        '500':\n          description: Unknown error occurs.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n  /sessions:\n    post:\n      summary: Create a new login session.\n      description: |\n        Given the username and password, login and obtain the cookie credential.\n        The issued cookie will be returned with \"Set-Cookie\" header.\n      operationId: createSession\n      requestBody:\n        content:\n          'application/json':\n            schema:\n              $ref: '#/components/schemas/Session'\n      responses:\n        '201':\n          description: The session is created successfully\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Session'\n        '400':\n          description: Invalid request.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n        '500':\n          description: Unknown error occurs.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n  /verifications:\n    post:\n      summary: Send a new email verification.\n      description: |\n        Send a new email verification for the given email address.\n        If \"username\" is carried, it will be used to lookup the account.\n        It should happen for sending verification email when user forgets password.\n        Otherwise, try to use cookie to decide the identity. It should happen when the\n        user is verifying an unverified email. Therefore, the email must be one of the\n        unverified email of the account. Otherwise, 400 is returned.\n      operationId: createVerification\n      requestBody:\n        content:\n          'application/json':\n            schema:\n              $ref: '#/components/schemas/Verification'\n      responses:\n        '201':\n          description: The verification is created successfully\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Verification'\n        '400':\n          description: Invalid request or credential too old.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n        '401':\n          description: Invalid credential or token (including expired cases).\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n        '500':\n          description: Unknown error occurs.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n    put:\n      summary: Submitting email verification OTP code.\n      description: |\n        Submitting OTP code for email verification for the given email address.\n        If `username` is carried, it's used to decide the identity, and a new cookie\n        credential is returned via `Set-Cookie` header on success.\n        Otherwise, cookie credential must be present, and will be used to decide the\n        identity. In such case, no new cookie credential is issued, and the email address\n        must be one of the unverified email of the account.\n      operationId: updateVerification\n      requestBody:\n        content:\n          'application/json':\n            schema:\n              $ref: '#/components/schemas/Verification'\n      responses:\n        '204':\n          description: The verification is finished successfully or the email is already verified.\n        '400':\n          description: Invalid request or credential too old.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n        '401':\n          description: Invalid credential or token (including expired cases).\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n        '500':\n          description: Unknown error occurs.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n  /tokens:\n    post:\n      summary: Create a new token.\n      description: |\n        Create a new token.\n        Cookie credential must be carried.\n        Depending on the type of the requested token, different criteria must be met:\n        - standard:\n          - Only need a valid and unexpired credential.\n        - critical:\n          - The credential must be valid and be issued in the last 5 minutes.\n      operationId: createToken\n      parameters:\n        - name: \"cookie\"\n          in: \"header\"\n          schema:\n            type: string\n          required: true\n      requestBody:\n        content:\n          'application/json':\n            schema:\n              $ref: '#/components/schemas/Token'\n      responses:\n        '201':\n          description: The session is created successfully\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Token'\n        '400':\n          description: Invalid request or credential too old.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n        '401':\n          description: Invalid credential.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\n        '500':\n          description: Unknown error occurs.\n          content:\n            application/json:\n              schema:\n                $ref: '#/components/schemas/Error'\ncomponents:\n  schemas:\n    Account:\n      type: \"object\"\n      properties:\n        username:\n          type: \"string\"\n          pattern: '^[A-Za-z0-9_-]{1,30}$'\n        firstName:\n          type: \"string\"\n          pattern: '^[A-Za-z]{1,20}$'\n        lastName:\n          type: \"string\"\n          pattern: '^[A-Za-z]{1,20}$'\n        email:\n          type: \"string\"\n          pattern: '^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+$'\n        password:\n          type: \"string\"\n          minLength: 6\n          maxLength: 30\n        description:\n          type: \"string\"\n          maxLength: 500\n    Session:\n      type: \"object\"\n      properties:\n        username:\n          type: \"string\"\n        password:\n          type: \"string\"\n        tags:\n          type: array\n          items:\n            type: string\n            enum:\n              - emailUnverified\n    Token:\n      type: \"object\"\n      properties:\n        value:\n          type: \"string\"\n        type:\n          type: \"string\"\n          enum:\n            - STANDARD\n            - CRITICAL\n    Verification:\n      type: object\n      properties:\n        username:\n          type: string\n        type:\n          type: string\n          enum:\n            - email\n        value:\n          type: string\n        otp:\n          type: string\n    Error:\n      type: \"object\"\n      properties:\n        code:\n          type: \"integer\"\n          example: 500000\n        message:\n          type: \"string\"\n          example: \"Unknown server error\"\n\n  securitySchemes:\n    cookieAuth:  # arbitrary name for the security scheme\n      type: apiKey\n      in: cookie\n      name: V  # cookie name",
			"canonicalURL": "/github.com/ssdlc-education/identity-service@645bc71b63b1ff8068908185c13f5e9527613df6/-/blob/backend/src/main/resources/api.yaml",
			"externalURLs": [
				{
					"url": "https://github.com/ssdlc-education/identity-service/blob/645bc71b63b1ff8068908185c13f5e9527613df6/backend/src/main/resources/api.yaml",
					"serviceKind": "GITHUB"
				}
			]
		}
	}
}