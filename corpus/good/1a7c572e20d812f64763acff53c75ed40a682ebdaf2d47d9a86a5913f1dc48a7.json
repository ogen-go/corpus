{
	"File": {
		"__typename": "FileMatch",
		"repository": {
			"name": "github.com/aws-samples/aws-serverless-saas-workshop"
		},
		"file": {
			"name": "apigateway.yaml",
			"size": 0,
			"path": "Solution/Lab6/server/nested_templates/apigateway.yaml",
			"byteSize": 43483,
			"content": "# Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n# SPDX-License-Identifier: MIT-0\n\nAWSTemplateFormatVersion: \"2010-09-09\"\nTransform: AWS::Serverless-2016-10-31\nDescription: \u003e\n  Template to setup api gateway, apis, api keys and usage plan as part of bootstrap\nParameters:\n  StageName:\n    Type: String\n  RegisterTenantLambdaExecutionRoleArn:\n    Type: String\n  TenantManagementLambdaExecutionRoleArn:\n    Type: String\n  RegisterTenantFunctionArn:\n    Type: String\n  ProvisionTenantFunctionArn:\n    Type: String\n  DeProvisionTenantFunctionArn:\n    Type: String\n  ActivateTenantFunctionArn:\n    Type: String\n  GetTenantsFunctionArn:\n    Type: String\n  CreateTenantFunctionArn:\n    Type: String\n  GetTenantFunctionArn:\n    Type: String\n  DeactivateTenantFunctionArn:\n    Type: String\n  UpdateTenantFunctionArn:\n    Type: String\n  GetTenantConfigFunctionArn:\n    Type: String\n  GetUsersFunctionArn:\n    Type: String    \n  GetUserFunctionArn:\n    Type: String\n  UpdateUserFunctionArn:\n    Type: String\n  DisableUserFunctionArn:\n    Type: String\n  CreateTenantAdminUserFunctionArn:\n    Type: String\n  CreateUserFunctionArn:\n    Type: String\n  DisableUsersByTenantFunctionArn:\n    Type: String\n  EnableUsersByTenantFunctionArn:\n    Type: String\n  AuthorizerFunctionArn:\n    Type: String\n  ApiKeyOperationUsersParameter:\n    Type: String    \n  ApiKeyPlatinumTierParameter:\n    Type: String\n  ApiKeyPremiumTierParameter:\n    Type: String\n  ApiKeyStandardTierParameter:\n    Type: String\n  ApiKeyBasicTierParameter:\n    Type: String  \n  \nResources:\n  ApiGatewayCloudWatchLogRole:\n    Type: AWS::IAM::Role\n    Properties:\n      RoleName: !Sub apigateway-cloudwatch-publish-role-${AWS::Region}\n      Path: \"/\"\n      ManagedPolicyArns:\n        - arn:aws:iam::aws:policy/service-role/AmazonAPIGatewayPushToCloudWatchLogs\n      AssumeRolePolicyDocument:\n        Version: 2012-10-17\n        Statement:\n          - Effect: Allow\n            Principal:\n              Service:\n                - apigateway.amazonaws.com\n            Action:\n              - sts:AssumeRole\n  ApiGatewayAttachCloudwatchLogArn:\n    Type: AWS::ApiGateway::Account\n    Properties:\n      CloudWatchRoleArn: !GetAtt ApiGatewayCloudWatchLogRole.Arn\n\n  AdminApiGatewayAccessLogs:\n    Type: AWS::Logs::LogGroup\n    Properties:\n      LogGroupName: !Sub /aws/api-gateway/access-logs-serverless-saas-admin-api\n      RetentionInDays: 30\n  AdminApiGatewayApi:\n    Type: AWS::Serverless::Api\n    Properties:\n      MethodSettings:\n        - DataTraceEnabled: False\n          LoggingLevel: INFO\n          MetricsEnabled: True\n          ResourcePath: \"/*\"\n          HttpMethod: \"*\"\n      Auth:\n        ResourcePolicy:\n          CustomStatements:\n            - Effect: Allow\n              Principal: \"*\"\n              Action: \"execute-api:Invoke\"\n              Resource: [\"execute-api:/*/*/*\"]\n            - Effect: Deny\n              Principal: \"*\"\n              Action: \"execute-api:Invoke\"\n              Resource: \n                - !Join [\n                   \"\",\n                   [\n                     \"execute-api:/\", !Ref StageName, \"/POST/tenant\"\n                   ]\n                  ] \n                - !Join [ \"\", [\n                     \"execute-api:/\", !Ref StageName, \"/POST/user/tenant-admin\"\n                   ]\n                 ]\n                - !Join [\n                   \"\",\n                   [\n                     \"execute-api:/\", !Ref StageName, \"/POST/provisioning\"\n                   ]\n                  ] \n              Condition:\n                StringNotEquals:\n                  aws:PrincipalArn:\n                    - !Ref RegisterTenantLambdaExecutionRoleArn \n                    - !Ref TenantManagementLambdaExecutionRoleArn \n            - Effect: Deny\n              Principal: \"*\"\n              Action: \"execute-api:Invoke\"\n              Resource: \n                - !Join [ \"\", [\n                     \"execute-api:/\", !Ref StageName, \"/PUT/users/disable\"\n                   ]\n                 ]                \n              Condition:\n                StringNotEquals:\n                  aws:PrincipalArn:\n                    - !Ref TenantManagementLambdaExecutionRoleArn\n            - Effect: Deny\n              Principal: \"*\"\n              Action: \"execute-api:Invoke\"\n              Resource: \n                - !Join [ \"\", [\n                     \"execute-api:/\", !Ref StageName, \"/PUT/users/enable\"\n                   ]\n                 ]                \n              Condition:\n                StringNotEquals:\n                  aws:PrincipalArn:\n                    - !Ref TenantManagementLambdaExecutionRoleArn\n            - Effect: Deny\n              Principal: \"*\"\n              Action: \"execute-api:Invoke\"\n              Resource: \n                - !Join [ \"\", [\n                     \"execute-api:/\", !Ref StageName, \"/PUT/provisioning/{tenantid}\"\n                   ]\n                 ]                \n              Condition:\n                StringNotEquals:\n                  aws:PrincipalArn:\n                    - !Ref TenantManagementLambdaExecutionRoleArn\n      AccessLogSetting:\n        DestinationArn: !GetAtt AdminApiGatewayAccessLogs.Arn\n        Format: '{ \"requestId\":\"$context.requestId\", \"ip\": \"$context.identity.sourceIp\", \"caller\":\"$context.identity.caller\", \"user\":\"$context.identity.user\",\"requestTime\":\"$context.requestTime\", \"httpMethod\":\"$context.httpMethod\",\"resourcePath\":\"$context.resourcePath\", \"status\":\"$context.status\",\"protocol\":\"$context.protocol\", \"responseLength\":\"$context.responseLength\" }'\n      TracingEnabled: True\n      DefinitionBody:\n        openapi: 3.0.1\n        info:\n          title: !Join [\"\", [\"serverless-saas-admin-api-\", !Ref \"AWS::Region\"]]\n        basePath: !Join [\"\", [\"/\", !Ref StageName]]\n        x-amazon-apigateway-api-key-source : \"AUTHORIZER\"\n        schemes:\n          - https\n        paths:\n          /registration:\n            post:\n              summary: Register a new tenant\n              description: Register a new tenant\n              produces:\n                - application/json\n              responses: {}\n              x-amazon-apigateway-integration:\n                uri: !Join\n                  - \"\"\n                  - - !Sub arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/\n                    - !Ref RegisterTenantFunctionArn\n                    - /invocations\n                httpMethod: POST\n                type: aws_proxy\n            options:\n              consumes:\n                - application/json\n              produces:\n                - application/json\n              responses:\n                \"200\":\n                  description: 200 response\n                  schema:\n                    $ref: \"#/definitions/Empty\"\n                  headers:\n                    Access-Control-Allow-Origin:\n                      type: string\n                    Access-Control-Allow-Methods:\n                      type: string\n                    Access-Control-Allow-Headers:\n                      type: string\n              x-amazon-apigateway-integration:\n                responses:\n                  default:\n                    statusCode: 200\n                    responseParameters:\n                      method.response.header.Access-Control-Allow-Methods: \"'DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT'\"\n                      method.response.header.Access-Control-Allow-Headers: \"'Content-Type,Authorization,X-Amz-Date,X-Api-Key,X-Amz-Security-Token'\"\n                      method.response.header.Access-Control-Allow-Origin: \"'*'\"\n                passthroughBehavior: when_no_match\n                requestTemplates:\n                  application/json: '{\"statusCode\": 200}'\n                type: mock                   \n          /provisioning:\n            post:\n              summary: provisions resource for new tenant\n              description: provisions resource for new tenant\n              produces:\n                - application/json\n              responses: {}\n              security:\n                - sigv4Reference: []\n              x-amazon-apigateway-integration:\n                uri: !Join\n                  - ''\n                  - - !Sub arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/\n                    -  !Ref ProvisionTenantFunctionArn\n                    - /invocations\n                httpMethod: POST\n                type: aws_proxy            \n            options:\n              consumes:\n                - application/json\n              produces:\n                - application/json\n              responses:\n                '200':\n                  description: 200 response\n                  schema:\n                    $ref: \"#/definitions/Empty\"\n                  headers:\n                    Access-Control-Allow-Origin:\n                      type: string\n                    Access-Control-Allow-Methods:\n                      type: string\n                    Access-Control-Allow-Headers:\n                      type: string\n              x-amazon-apigateway-integration:\n                responses:\n                  default:\n                    statusCode: 200\n                    responseParameters:\n                      method.response.header.Access-Control-Allow-Methods: \"'DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT'\"\n                      method.response.header.Access-Control-Allow-Headers: \"'Content-Type,Authorization,X-Amz-Date,X-Api-Key,X-Amz-Security-Token'\"\n                      method.response.header.Access-Control-Allow-Origin:  \"'*'\"\n                passthroughBehavior: when_no_match\n                requestTemplates:\n                  application/json: \"{\\\"statusCode\\\": 200}\"\n                type: mock \n          /provisioning/{tenantid}:\n            put:\n              summary: deprovision by tenant\n              description: deprovision by tenant\n              produces:\n                - application/json\n              responses:\n                '200':\n                  description: 200 response\n                  schema:\n                    $ref: \"#/definitions/Empty\"\n                  headers:\n                    Access-Control-Allow-Origin:\n                      type: string\n                    Access-Control-Allow-Methods:\n                      type: string\n                    Access-Control-Allow-Headers:\n                      type: string\n              security:                \n                - sigv4Reference: []\n              x-amazon-apigateway-integration:\n                responses:\n                  default:\n                    statusCode: 200\n                    responseParameters:\n                      method.response.header.Access-Control-Allow-Methods: \"'DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT'\"\n                      method.response.header.Access-Control-Allow-Headers: \"'Content-Type,Authorization,X-Amz-Date,X-Api-Key,X-Amz-Security-Token'\"\n                      method.response.header.Access-Control-Allow-Origin:  \"'*'\"\n                passthroughBehavior: when_no_match                \n                uri: !Join\n                  - ''\n                  - - !Sub arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/\n                    -  !Ref DeProvisionTenantFunctionArn\n                    - /invocations\n                httpMethod: POST\n                type: AWS\n                requestParameters:\n                  integration.request.header.X-Amz-Invocation-Type: '''Event'''\n                        \n            options:\n              consumes:\n                - application/json\n              produces:\n                - application/json\n              responses:\n                '200':\n                  description: 200 response\n                  schema:\n                    $ref: \"#/definitions/Empty\"\n                  headers:\n                    Access-Control-Allow-Origin:\n                      type: string\n                    Access-Control-Allow-Methods:\n                      type: string\n                    Access-Control-Allow-Headers:\n                      type: string\n              x-amazon-apigateway-integration:\n                responses:\n                  default:\n                    statusCode: 200\n                    responseParameters:\n                      method.response.header.Access-Control-Allow-Methods: \"'DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT'\"\n                      method.response.header.Access-Control-Allow-Headers: \"'Content-Type,Authorization,X-Amz-Date,X-Api-Key,X-Amz-Security-Token'\"\n                      method.response.header.Access-Control-Allow-Origin:  \"'*'\"\n                passthroughBehavior: when_no_match\n                requestTemplates:\n                  application/json: \"{\\\"statusCode\\\": 200}\"\n                type: mock  \n          /tenant/activation/{tenantid}:\n            put:\n              security:\n                - api_key: []\n                - Authorizer: []\n              summary: Activate an existing tenant\n              description: Activate an existing tenant\n              produces:\n                - application/json\n              responses: {}\n              x-amazon-apigateway-integration:\n                uri: !Join\n                  - \"\"\n                  - - !Sub arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/\n                    - !Ref ActivateTenantFunctionArn\n                    - /invocations\n                httpMethod: POST\n                type: aws_proxy\n            options:\n              consumes:\n                - application/json\n              produces:\n                - application/json\n              responses:\n                \"200\":\n                  description: 200 response\n                  schema:\n                    $ref: \"#/definitions/Empty\"\n                  headers:\n                    Access-Control-Allow-Origin:\n                      type: string\n                    Access-Control-Allow-Methods:\n                      type: string\n                    Access-Control-Allow-Headers:\n                      type: string\n              x-amazon-apigateway-integration:\n                responses:\n                  default:\n                    statusCode: 200\n                    responseParameters:\n                      method.response.header.Access-Control-Allow-Methods: \"'DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT'\"\n                      method.response.header.Access-Control-Allow-Headers: \"'Content-Type,Authorization,X-Amz-Date,X-Api-Key,X-Amz-Security-Token'\"\n                      method.response.header.Access-Control-Allow-Origin: \"'*'\"\n                passthroughBehavior: when_no_match\n                requestTemplates:\n                  application/json: '{\"statusCode\": 200}'\n                type: mock\n          /tenants:\n            get:\n              summary: Returns all tenants\n              description: Returns all tenants\n              produces:\n                - application/json\n              responses: {}\n              security:\n                - api_key: []\n                - Authorizer: []\n              x-amazon-apigateway-integration:\n                uri: !Join\n                  - ''\n                  - - !Sub arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/\n                    -  !Ref GetTenantsFunctionArn\n                    - /invocations\n                httpMethod: POST\n                type: aws_proxy\n            options:\n              consumes:\n                - application/json\n              produces:\n                - application/json\n              responses:\n                \"200\":\n                  description: 200 response\n                  schema:\n                    $ref: \"#/definitions/Empty\"\n                  headers:\n                    Access-Control-Allow-Origin:\n                      type: string\n                    Access-Control-Allow-Methods:\n                      type: string\n                    Access-Control-Allow-Headers:\n                      type: string\n              x-amazon-apigateway-integration:\n                responses:\n                  default:\n                    statusCode: 200\n                    responseParameters:\n                      method.response.header.Access-Control-Allow-Methods: \"'DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT'\"\n                      method.response.header.Access-Control-Allow-Headers: \"'Content-Type,Authorization,X-Amz-Date,X-Api-Key,X-Amz-Security-Token'\"\n                      method.response.header.Access-Control-Allow-Origin: \"'*'\"\n                passthroughBehavior: when_no_match\n                requestTemplates:\n                  application/json: '{\"statusCode\": 200}'\n                type: mock                 \n          /tenant:\n            post:\n              summary: Creates a tenant\n              description: Creates a tenant\n              produces:\n                - application/json\n              responses: {}\n              security:\n                - sigv4Reference: []\n              x-amazon-apigateway-integration:\n                uri: !Join\n                  - ''\n                  - - !Sub arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/\n                    -  !Ref CreateTenantFunctionArn\n                    - /invocations\n                httpMethod: POST\n                type: aws_proxy                \n            options:\n              consumes:\n                - application/json\n              produces:\n                - application/json\n              responses:\n                '200':\n                  description: 200 response\n                  schema:\n                    $ref: \"#/definitions/Empty\"\n                  headers:\n                    Access-Control-Allow-Origin:\n                      type: string\n                    Access-Control-Allow-Methods:\n                      type: string\n                    Access-Control-Allow-Headers:\n                      type: string\n              x-amazon-apigateway-integration:\n                responses:\n                  default:\n                    statusCode: 200\n                    responseParameters:\n                      method.response.header.Access-Control-Allow-Methods: \"'DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT'\"\n                      method.response.header.Access-Control-Allow-Headers: \"'Content-Type,Authorization,X-Amz-Date,X-Api-Key,X-Amz-Security-Token'\"\n                      method.response.header.Access-Control-Allow-Origin:  \"'*'\"\n                passthroughBehavior: when_no_match\n                requestTemplates:\n                  application/json: \"{\\\"statusCode\\\": 200}\"\n                type: mock \n          /tenant/init/{tenantname}:\n            get:\n              summary: Returns a tenant config\n              description: Return a tenant config by a tenant name\n              produces:\n                - application/json\n              responses: {}\n              x-amazon-apigateway-integration:\n                uri: !Join\n                  - ''\n                  - - !Sub arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/\n                    -  !Ref GetTenantConfigFunctionArn\n                    - /invocations\n                httpMethod: POST\n                type: aws_proxy \n            options:\n              consumes:\n                - application/json\n              produces:\n                - application/json\n              responses:\n                '200':\n                  description: 200 response\n                  schema:\n                    $ref: \"#/definitions/Empty\"\n                  headers:\n                    Access-Control-Allow-Origin:\n                      type: string\n                    Access-Control-Allow-Methods:\n                      type: string\n                    Access-Control-Allow-Headers:\n                      type: string\n              x-amazon-apigateway-integration:\n                responses:\n                  default:\n                    statusCode: 200\n                    responseParameters:\n                      method.response.header.Access-Control-Allow-Methods: \"'DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT'\"\n                      method.response.header.Access-Control-Allow-Headers: \"'Content-Type,Authorization,X-Amz-Date,X-Api-Key,X-Amz-Security-Token'\"\n                      method.response.header.Access-Control-Allow-Origin:  \"'*'\"\n                passthroughBehavior: when_no_match\n                requestTemplates:\n                  application/json: \"{\\\"statusCode\\\": 200}\"\n                type: mock        \n          /tenant/{tenantid}:\n            get:\n              summary: Returns a tenant\n              description: Return a tenant by a tenant id\n              produces:\n                - application/json\n              responses: {}\n              security:   \n                - api_key: []\n                - Authorizer: []\n              x-amazon-apigateway-integration:\n                uri: !Join\n                  - ''\n                  - - !Sub arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/\n                    -  !Ref GetTenantFunctionArn\n                    - /invocations\n                httpMethod: POST\n                type: aws_proxy        \n            delete:              \n              summary: Disables a tenant\n              description: Disables a tenant by a tenant id\n              produces:\n                - application/json\n              responses: {}\n              security:   \n                - api_key: []\n                - Authorizer: []\n              x-amazon-apigateway-integration:\n                uri: !Join\n                  - ''\n                  - - !Sub arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/\n                    -  !Ref DeactivateTenantFunctionArn\n                    - /invocations\n                httpMethod: POST\n                type: aws_proxy\n            put:  \n              summary: Updates a tenant\n              description: Updates a tenant\n              produces:\n                - application/json\n              responses: {}\n              security:        \n                - api_key: []\n                - Authorizer: []\n              x-amazon-apigateway-integration:\n                uri: !Join\n                  - ''\n                  - - !Sub arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/\n                    -  !Ref UpdateTenantFunctionArn\n                    - /invocations\n                httpMethod: POST\n                type: aws_proxy            \n            options:\n              consumes:\n                - application/json\n              produces:\n                - application/json\n              responses:\n                '200':\n                  description: 200 response\n                  schema:\n                    $ref: \"#/definitions/Empty\"\n                  headers:\n                    Access-Control-Allow-Origin:\n                      type: string\n                    Access-Control-Allow-Methods:\n                      type: string\n                    Access-Control-Allow-Headers:\n                      type: string\n              x-amazon-apigateway-integration:\n                responses:\n                  default:\n                    statusCode: 200\n                    responseParameters:\n                      method.response.header.Access-Control-Allow-Methods: \"'DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT'\"\n                      method.response.header.Access-Control-Allow-Headers: \"'Content-Type,Authorization,X-Amz-Date,X-Api-Key,X-Amz-Security-Token'\"\n                      method.response.header.Access-Control-Allow-Origin:  \"'*'\"\n                passthroughBehavior: when_no_match\n                requestTemplates:\n                  application/json: \"{\\\"statusCode\\\": 200}\"\n                type: mock     \n            \n          /user/{username}:\n            get:\n              summary: Returns a user\n              description: Return a user by a user id\n              produces:\n                - application/json\n              responses: {}\n              security:    \n                - api_key: [] \n                - Authorizer: []\n              x-amazon-apigateway-integration:\n                uri: !Join\n                  - ''\n                  - - !Sub arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/\n                    -  !Ref GetUserFunctionArn\n                    - /invocations\n                httpMethod: POST\n                type: aws_proxy    \n            put:              \n              produces:\n                - application/json\n              responses: {}\n              security:         \n                - api_key: []       \n                - Authorizer: []\n              x-amazon-apigateway-integration:\n                uri: !Join\n                  - ''\n                  - - !Sub arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/\n                    -  !Ref UpdateUserFunctionArn\n                    - /invocations\n                httpMethod: POST\n                type: aws_proxy\n            delete:          \n              summary: Diables a user\n              description: Disable a user by a user id    \n              produces:\n                - application/json\n              responses: {}\n              security: \n                - api_key: []\n                - Authorizer: []\n              x-amazon-apigateway-integration:\n                uri: !Join\n                  - ''\n                  - - !Sub arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/\n                    -  !Ref DisableUserFunctionArn\n                    - /invocations\n                httpMethod: POST\n                type: aws_proxy\n          /user/tenant-admin:\n            post:\n              summary: Creates a tenant admin user\n              description: Creates a tenant admin user\n              produces:\n                - application/json\n              responses: {}\n              security:\n                - sigv4Reference: []\n              x-amazon-apigateway-integration:\n                uri: !Join\n                  - ''\n                  - - !Sub arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/\n                    -  !Ref CreateTenantAdminUserFunctionArn\n                    - /invocations\n                httpMethod: POST\n                type: aws_proxy          \n            options:\n              consumes:\n                - application/json\n              produces:\n                - application/json\n              responses:\n                '200':\n                  description: 200 response\n                  schema:\n                    $ref: \"#/definitions/Empty\"\n                  headers:\n                    Access-Control-Allow-Origin:\n                      type: string\n                    Access-Control-Allow-Methods:\n                      type: string\n                    Access-Control-Allow-Headers:\n                      type: string\n              x-amazon-apigateway-integration:\n                responses:\n                  default:\n                    statusCode: 200\n                    responseParameters:\n                      method.response.header.Access-Control-Allow-Methods: \"'DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT'\"\n                      method.response.header.Access-Control-Allow-Headers: \"'Content-Type,Authorization,X-Amz-Date,X-Api-Key,X-Amz-Security-Token'\"\n                      method.response.header.Access-Control-Allow-Origin:  \"'*'\"\n                passthroughBehavior: when_no_match\n                requestTemplates:\n                  application/json: \"{\\\"statusCode\\\": 200}\"\n                type: mock       \n          /user:\n            post:\n              summary: Create a user\n              description: Create a user by a user id\n              produces:\n                - application/json\n              responses: {}\n              security:  \n                - api_key: []          \n                - Authorizer: []\n              x-amazon-apigateway-integration:\n                uri: !Join\n                  - ''\n                  - - !Sub arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/\n                    -  !Ref CreateUserFunctionArn\n                    - /invocations\n                httpMethod: POST\n                type: aws_proxy\n                        \n            options:\n              consumes:\n                - application/json\n              produces:\n                - application/json\n              responses:\n                '200':\n                  description: 200 response\n                  schema:\n                    $ref: \"#/definitions/Empty\"\n                  headers:\n                    Access-Control-Allow-Origin:\n                      type: string\n                    Access-Control-Allow-Methods:\n                      type: string\n                    Access-Control-Allow-Headers:\n                      type: string\n              x-amazon-apigateway-integration:\n                responses:\n                  default:\n                    statusCode: 200\n                    responseParameters:\n                      method.response.header.Access-Control-Allow-Methods: \"'DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT'\"\n                      method.response.header.Access-Control-Allow-Headers: \"'Content-Type,Authorization,X-Amz-Date,X-Api-Key,X-Amz-Security-Token'\"\n                      method.response.header.Access-Control-Allow-Origin:  \"'*'\"\n                passthroughBehavior: when_no_match\n                requestTemplates:\n                  application/json: \"{\\\"statusCode\\\": 200}\"\n                type: mock \n          /users:\n            get:\n              summary: Get all users by tenantId\n              description: Get all users by tenantId\n              produces:\n                - application/json\n              responses: {}\n              security:   \n                - api_key: []\n                - Authorizer: []\n              x-amazon-apigateway-integration:\n                uri: !Join\n                  - ''\n                  - - !Sub arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/\n                    -  !Ref GetUsersFunctionArn\n                    - /invocations\n                httpMethod: POST\n                type: aws_proxy\n                        \n            options:\n              consumes:\n                - application/json\n              produces:\n                - application/json\n              responses:\n                '200':\n                  description: 200 response\n                  schema:\n                    $ref: \"#/definitions/Empty\"\n                  headers:\n                    Access-Control-Allow-Origin:\n                      type: string\n                    Access-Control-Allow-Methods:\n                      type: string\n                    Access-Control-Allow-Headers:\n                      type: string\n              x-amazon-apigateway-integration:\n                responses:\n                  default:\n                    statusCode: 200\n                    responseParameters:\n                      method.response.header.Access-Control-Allow-Methods: \"'DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT'\"\n                      method.response.header.Access-Control-Allow-Headers: \"'Content-Type,Authorization,X-Amz-Date,X-Api-Key,X-Amz-Security-Token'\"\n                      method.response.header.Access-Control-Allow-Origin:  \"'*'\"\n                passthroughBehavior: when_no_match\n                requestTemplates:\n                  application/json: \"{\\\"statusCode\\\": 200}\"\n                type: mock         \n          /users/disable:\n            put:\n              summary: disable users by tenant id\n              description: disable users by tenant id\n              produces:\n                - application/json\n              responses:\n                '200':\n                  description: 200 response\n                  schema:\n                    $ref: \"#/definitions/Empty\"\n                  headers:\n                    Access-Control-Allow-Origin:\n                      type: string\n                    Access-Control-Allow-Methods:\n                      type: string\n                    Access-Control-Allow-Headers:\n                      type: string\n              security:     \n                - sigv4Reference: []\n              x-amazon-apigateway-integration:\n                responses:\n                  default:\n                    statusCode: 200\n                    responseParameters:\n                      method.response.header.Access-Control-Allow-Methods: \"'DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT'\"\n                      method.response.header.Access-Control-Allow-Headers: \"'Content-Type,Authorization,X-Amz-Date,X-Api-Key,X-Amz-Security-Token'\"\n                      method.response.header.Access-Control-Allow-Origin:  \"'*'\"\n                passthroughBehavior: when_no_match                \n                uri: !Join\n                  - ''\n                  - - !Sub arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/\n                    -  !Ref DisableUsersByTenantFunctionArn\n                    - /invocations\n                httpMethod: POST\n                type: AWS\n                requestParameters:\n                  integration.request.header.X-Amz-Invocation-Type: '''Event'''\n                        \n            options:\n              consumes:\n                - application/json\n              produces:\n                - application/json\n              responses:\n                '200':\n                  description: 200 response\n                  schema:\n                    $ref: \"#/definitions/Empty\"\n                  headers:\n                    Access-Control-Allow-Origin:\n                      type: string\n                    Access-Control-Allow-Methods:\n                      type: string\n                    Access-Control-Allow-Headers:\n                      type: string\n              x-amazon-apigateway-integration:\n                responses:\n                  default:\n                    statusCode: 200\n                    responseParameters:\n                      method.response.header.Access-Control-Allow-Methods: \"'DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT'\"\n                      method.response.header.Access-Control-Allow-Headers: \"'Content-Type,Authorization,X-Amz-Date,X-Api-Key,X-Amz-Security-Token'\"\n                      method.response.header.Access-Control-Allow-Origin:  \"'*'\"\n                passthroughBehavior: when_no_match\n                requestTemplates:\n                  application/json: \"{\\\"statusCode\\\": 200}\"\n                type: mock  \n          /users/enable:\n            put:\n              summary: enable users by tenant id\n              description: enable users by tenant id\n              produces:\n                - application/json\n              responses:\n                '200':\n                  description: 200 response\n                  schema:\n                    $ref: \"#/definitions/Empty\"\n                  headers:\n                    Access-Control-Allow-Origin:\n                      type: string\n                    Access-Control-Allow-Methods:\n                      type: string\n                    Access-Control-Allow-Headers:\n                      type: string\n              security:     \n                - sigv4Reference: []\n              x-amazon-apigateway-integration:\n                responses:\n                  default:\n                    statusCode: 200\n                    responseParameters:\n                      method.response.header.Access-Control-Allow-Methods: \"'DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT'\"\n                      method.response.header.Access-Control-Allow-Headers: \"'Content-Type,Authorization,X-Amz-Date,X-Api-Key,X-Amz-Security-Token'\"\n                      method.response.header.Access-Control-Allow-Origin:  \"'*'\"\n                passthroughBehavior: when_no_match                \n                uri: !Join\n                  - ''\n                  - - !Sub arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/\n                    -  !Ref EnableUsersByTenantFunctionArn\n                    - /invocations\n                httpMethod: POST\n                type: AWS\n                requestParameters:\n                  integration.request.header.X-Amz-Invocation-Type: '''Event'''\n                        \n            options:\n              consumes:\n                - application/json\n              produces:\n                - application/json\n              responses:\n                '200':\n                  description: 200 response\n                  schema:\n                    $ref: \"#/definitions/Empty\"\n                  headers:\n                    Access-Control-Allow-Origin:\n                      type: string\n                    Access-Control-Allow-Methods:\n                      type: string\n                    Access-Control-Allow-Headers:\n                      type: string\n              x-amazon-apigateway-integration:\n                responses:\n                  default:\n                    statusCode: 200\n                    responseParameters:\n                      method.response.header.Access-Control-Allow-Methods: \"'DELETE,GET,HEAD,OPTIONS,PATCH,POST,PUT'\"\n                      method.response.header.Access-Control-Allow-Headers: \"'Content-Type,Authorization,X-Amz-Date,X-Api-Key,X-Amz-Security-Token'\"\n                      method.response.header.Access-Control-Allow-Origin:  \"'*'\"\n                passthroughBehavior: when_no_match\n                requestTemplates:\n                  application/json: \"{\\\"statusCode\\\": 200}\"\n                type: mock  \n        components:\n          securitySchemes:      \n            api_key:\n              type: \"apiKey\"\n              name: \"x-api-key\"\n              in: \"header\"     \n            sigv4Reference:\n              type: \"apiKey\"\n              name: \"Authorization\"\n              in: \"header\"\n              x-amazon-apigateway-authtype: \"awsSigv4\"  \n            Authorizer:\n              type: \"apiKey\"\n              name: \"Authorization\"\n              in: \"header\"\n              x-amazon-apigateway-authtype: \"custom\"\n              x-amazon-apigateway-authorizer:\n                authorizerUri: !Join\n                  - ''\n                  - - !Sub arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/\n                    -  !Ref AuthorizerFunctionArn\n                    - /invocations\n                authorizerResultTtlInSeconds: 60\n                type: \"token\"\n      StageName: prod\n  \n #Create API Keys and Usage Plans\n  APIGatewayApiKeySystemAdmin:\n    Type: AWS::ApiGateway::ApiKey\n    Properties:\n      Description: \"This is the api key to be used by system admin\"\n      Enabled: True\n      Name: Serverless-SaaS-SysAdmin-ApiKey\n      Value: !Ref ApiKeyOperationUsersParameter\n  APIGatewayApiKeyPlatinumTier:\n    Type: AWS::ApiGateway::ApiKey\n    Properties: \n      Description: 'This is the api key to be used by platinum tier tenants'\n      Enabled: True\n      Name: Serverless-SaaS-PlatinumTier-ApiKey\n      Value: !Ref ApiKeyPlatinumTierParameter\n  APIGatewayApiKeyPremiumTier:\n    Type: AWS::ApiGateway::ApiKey\n    Properties: \n      Description: 'This is the api key to be used by premium tier tenants'\n      Enabled: True\n      Name: Serverless-SaaS-PremiumTier-ApiKey\n      Value: !Ref ApiKeyPremiumTierParameter\n  APIGatewayApiKeyStandardTier:\n    Type: AWS::ApiGateway::ApiKey\n    Properties: \n      Description: 'This is the api key to be used by standard tier tenants'\n      Enabled: True\n      Name: Serverless-SaaS-StandardTier-ApiKey\n      Value: !Ref ApiKeyStandardTierParameter\n  APIGatewayApiKeyBasicTier:\n    Type: AWS::ApiGateway::ApiKey\n    Properties: \n      Description: 'This is the api key to be used by basic tier tenants'\n      Enabled: True\n      Name: Serverless-SaaS-BasicTier-ApiKey\n      Value: !Ref ApiKeyBasicTierParameter\n\n  UsagePlanPlatinumTier:   \n    Type: 'AWS::ApiGateway::UsagePlan'\n    Properties:\n      ApiStages:\n        - ApiId: !Ref AdminApiGatewayApi\n          Stage: !Ref StageName\n      Description: Usage plan for platinum tier tenants\n      Quota:\n        Limit: 10000\n        Period: DAY\n      Throttle:\n        BurstLimit: 300\n        RateLimit: 300\n      UsagePlanName: Plan_Platinum_Tier\n    DependsOn: \n      - AdminApiGatewayApiprodStage\n  UsagePlanPremiumTier:   \n    Type: 'AWS::ApiGateway::UsagePlan'\n    Properties:\n      ApiStages:\n        - ApiId: !Ref AdminApiGatewayApi\n          Stage: !Ref StageName\n      Description: Usage plan for premium tier tenants\n      Quota:\n        Limit: 5000\n        Period: DAY\n      Throttle:\n        BurstLimit: 200\n        RateLimit: 100\n      UsagePlanName: Plan_Premium_Tier\n    DependsOn: \n      - AdminApiGatewayApiprodStage\n  UsagePlanStandardTier: \n    Type: 'AWS::ApiGateway::UsagePlan'\n    Properties:\n      ApiStages:\n        - ApiId: !Ref AdminApiGatewayApi\n          Stage: !Ref StageName\n      Description: Usage plan for standard tier tenants\n      Quota:\n        Limit: 3000\n        Period: DAY\n      Throttle:\n        BurstLimit: 100\n        RateLimit: 75\n      UsagePlanName: Plan_Standard_Tier\n    DependsOn: \n      - AdminApiGatewayApiprodStage\n  UsagePlanBasicTier:   \n    Type: 'AWS::ApiGateway::UsagePlan'\n    Properties:\n      ApiStages:\n        - ApiId: !Ref AdminApiGatewayApi\n          Stage: !Ref StageName\n      Description: Usage plan for basic tier tenants\n      Quota:\n        Limit: 500\n        Period: DAY\n      Throttle:\n        BurstLimit: 50\n        RateLimit: 50\n      UsagePlanName: Plan_Basic_Tier\n    DependsOn: \n      - AdminApiGatewayApiprodStage\n  UsagePlanSystemAdmin:\n    Type: \"AWS::ApiGateway::UsagePlan\"\n    Properties:\n      ApiStages:\n        - ApiId: !Ref AdminApiGatewayApi\n          Stage: !Ref StageName\n      Description: Usage plan for system admin\n      Quota:\n        Limit: 10000\n        Period: DAY\n      Throttle:\n        BurstLimit: 5000\n        RateLimit: 500\n      UsagePlanName: System_Admin_Usage_Plan\n    DependsOn:\n      - AdminApiGatewayApiprodStage\n\n  AssociateAPIKeyToUsagePlan:\n    Type: AWS::ApiGateway::UsagePlanKey\n    Properties:\n      KeyId: !Ref APIGatewayApiKeySystemAdmin\n      KeyType: API_KEY\n      UsagePlanId: !Ref UsagePlanSystemAdmin\n    DependsOn: UsagePlanSystemAdmin\n  AssociatePlatinumAPIKeyToUsagePlan:\n    Type: AWS::ApiGateway::UsagePlanKey\n    Properties: \n      KeyId: !Ref APIGatewayApiKeyPlatinumTier\n      KeyType: API_KEY\n      UsagePlanId: !Ref UsagePlanPlatinumTier\n    DependsOn: UsagePlanPlatinumTier\n  AssociatePremiumAPIKeyToUsagePlan:\n    Type: AWS::ApiGateway::UsagePlanKey\n    Properties: \n      KeyId: !Ref APIGatewayApiKeyPremiumTier\n      KeyType: API_KEY\n      UsagePlanId: !Ref UsagePlanPremiumTier\n    DependsOn: UsagePlanPremiumTier\n  AssociateStandardAPIKeyToUsagePlan:\n    Type: AWS::ApiGateway::UsagePlanKey\n    Properties: \n      KeyId: !Ref APIGatewayApiKeyStandardTier\n      KeyType: API_KEY\n      UsagePlanId: !Ref UsagePlanStandardTier\n    DependsOn: UsagePlanStandardTier\n  AssociateBasicAPIKeyToUsagePlan:\n    Type: AWS::ApiGateway::UsagePlanKey\n    Properties: \n      KeyId: !Ref APIGatewayApiKeyBasicTier\n      KeyType: API_KEY\n      UsagePlanId: !Ref UsagePlanBasicTier\n    DependsOn: UsagePlanBasicTier\nOutputs:\n  UsagePlanBasicTier: \n    Value: !Ref UsagePlanBasicTier\n  UsagePlanStandardTier: \n    Value: !Ref UsagePlanStandardTier\n  UsagePlanPremiumTier: \n    Value: !Ref UsagePlanPremiumTier\n  UsagePlanPlatinumTier: \n    Value: !Ref UsagePlanPlatinumTier\n  AdminApiGatewayApi:\n    Value: !Ref AdminApiGatewayApi",
			"canonicalURL": "/github.com/aws-samples/aws-serverless-saas-workshop@5731506f22c965f231a6f7065edaa8cc949344ef/-/blob/Solution/Lab6/server/nested_templates/apigateway.yaml",
			"externalURLs": [
				{
					"url": "https://github.com/aws-samples/aws-serverless-saas-workshop/blob/5731506f22c965f231a6f7065edaa8cc949344ef/Solution/Lab6/server/nested_templates/apigateway.yaml",
					"serviceKind": "GITHUB"
				}
			]
		}
	}
}