{
	"File": {
		"__typename": "FileMatch",
		"repository": {
			"name": "github.com/UpdateHub/updatehub"
		},
		"file": {
			"name": "agent-http.yaml",
			"size": 0,
			"path": "doc/agent-http.yaml",
			"byteSize": 12474,
			"content": "openapi: 3.0.0\ninfo:\n  title: UpdateHub Agent local HTTP API routes\n  description: |-\n    These are the routes available through HTTP on the device running the\n    UpdateHub Agent.\n  version: \"2.0\"\nservers:\n  - url: \"http://localhost:8080\"\n    variables: {}\n\npaths:\n  \"/info\":\n    get:\n      summary: \"Get general information.\"\n      responses:\n        \"200\":\n          description: \"Request accepted\"\n          content:\n            application/json:\n              schema:\n                $ref: \"#/components/schemas/AgentInfo\"\n\n  \"/probe\":\n    post:\n      summary: \"Actively probe the server.\"\n      description: |-\n        Probe the server and download the update metadata if available.  This\n        request accepts a \"server_address\" parameter on POST. When it's present,\n        it will use the address for the triggered probe process and following\n        requests in case there is an update available.\n\n        The returned JSON object is an enum with three possible possibilities:\n        \"updating\", \"no_update\" and \"try_again\".  The \"try_again\": is a object\n        that contains an integer which inform the caller it should retry the\n        request again in 'n' seconds from now.\n\n        If agent is busy (e.g. downloading a object or installing an object) the\n        returned http code is 406.\n      requestBody:\n        required: false\n        description: \"The custom server to probe\"\n        content:\n          application/json:\n              schema:\n                $ref: \"#/components/schemas/ProbeCustomServer\"\n      responses:\n        \"200\":\n          description: \"Request accepted\"\n          content:\n            application/json:\n              schema:\n                $ref: \"#/components/schemas/ProbeInfo\"\n              examples:\n                ex1:\n                  value:\n                    try_again: 3600\n                ex2:\n                  value:\n                    '\"updating\"'\n        \"406\":\n          description: \"Agent is busy\"\n          content:\n            application/json:\n              schema:\n                $ref: \"#/components/schemas/AgentState\"\n\n  \"/local_install\":\n    post:\n      summary: \"Install local package\"\n      description: |-\n        Request the agent for installation of a local package.\n      requestBody:\n        required: true\n        content:\n          application/json:\n              schema:\n                $ref: \"#/components/schemas/LocalInstallRequest\"\n      responses:\n        \"200\":\n          description: \"Request accepted\"\n          content:\n            application/json:\n              schema:\n                $ref: \"#/components/schemas/AgentState\"\n        \"406\":\n          description: \"Local instalation cond't start\"\n          content:\n            application/json:\n              schema:\n                $ref: \"#/components/schemas/AgentState\"\n\n  \"/remote_install\":\n    post:\n      summary: \"Download and install package from remote url\"\n      description: |-\n        Request the agent for installation of a remote package.\n      requestBody:\n        required: true\n        content:\n          application/json:\n              schema:\n                $ref: \"#/components/schemas/RemoteInstallRequest\"\n      responses:\n        \"200\":\n          description: \"Request accepted\"\n          content:\n            application/json:\n              schema:\n                $ref: \"#/components/schemas/AgentState\"\n        \"406\":\n          description: \"Remote instalation cond't start\"\n          content:\n            application/json:\n              schema:\n                $ref: \"#/components/schemas/AgentState\"\n\n  \"/update/download/abort\":\n    post:\n      summary: \"Abort download\"\n      description: |-\n        Abort an update download (triggered by any command). It returns the\n        current state of the agent when handling the abort together with the\n        respective HTTP code. On success the returned HTTP code is 200, and on\n        failure it is 406.\n      responses:\n        \"200\":\n          description: \"Download Aborted\"\n          content:\n            application/json:\n              schema:\n                $ref: \"#/components/schemas/AgentState\"\n        \"406\":\n          description: \"No download to be aborted\"\n          content:\n            application/json:\n              schema:\n                $ref: \"#/components/schemas/AgentState\"\n\n  \"/log\":\n    get:\n      summary: \"Fetch agent log\"\n      description: |-\n        Returns the agent log.\n      responses:\n        \"200\":\n          description: \"Log of last execution\"\n          content:\n            application/json:\n              schema:\n                $ref: \"#/components/schemas/Log\"\n\ncomponents:\n  schemas:\n    AgentInfo:\n      description: \"Information about the agent\"\n      required:\n        - state\n        - version\n        - config\n        - firmware\n        - runtime_settings\n      properties:\n        state:\n          $ref: \"#/components/schemas/AgentState\"\n        version:\n          type: string\n          example: \"0.1.0-87-ga836b13\"\n        config:\n          $ref: \"#/components/schemas/AgentInfoSettings\"\n        firmware:\n          $ref: \"#/components/schemas/AgentInfoFirmware\"\n        runtime_settings:\n          $ref: \"#/components/schemas/AgentInfoRuntimeSettings\"\n\n    ProbeInfo:\n      description: \"Response about requested probe\"\n      oneOf:\n        - type: string\n          enum: [\"updating\", \"no_update\"]\n        - type: object\n          required:\n            - try_again\n          properties:\n            try_again:\n              type: integer\n              example: 3600\n\n    ProbeCustomServer:\n      description: \"Server address which the update procedure will use for this request\"\n      type: object\n      required:\n        - custom_server\n      properties:\n        custom_server:\n          type: string\n          example: \"http://different-address:8080\"\n\n    LocalInstallRequest:\n      description: \"The update file which will be used for this request\"\n      type: object\n      required:\n        - file\n      properties:\n        file:\n          type: string\n          example: \"/tmp/updatehub-image-qa-uh-qemu-x86-64.uhupkg\"\n\n    RemoteInstallRequest:\n      description: \"URL to directly download the update file which will be used for this request\"\n      type: object\n      required:\n        - url\n      properties:\n        url:\n          type: string\n          example: \"https://some_remote_url.domain/update.uhupkg\"\n\n    AgentInfoSettings:\n      type: object\n      required:\n        - polling\n        - storage\n        - update\n        - network\n        - firmware\n      properties:\n        polling:\n          $ref: \"#/components/schemas/AgentInfoSettingsPolling\"\n        storage:\n          $ref: \"#/components/schemas/AgentInfoSettingsStorage\"\n        update:\n          $ref: \"#/components/schemas/AgentInfoSettingsUpdate\"\n        network:\n          $ref: \"#/components/schemas/AgentInfoSettingsNetwork\"\n        firmware:\n          $ref: \"#/components/schemas/AgentInfoSettingsFirmware\"\n\n    AgentInfoSettingsFirmware:\n      type: object\n      required:\n        - metadata\n      properties:\n        metadata:\n          type: string\n          example: \"/usr/share/updatehub\"\n\n    AgentInfoSettingsNetwork:\n      type: object\n      required:\n        - server_address\n        - listen_socket\n      properties:\n        server_address:\n          type: string\n          example: \"api.updatehub.io\"\n        listen_socket:\n          type: string\n          example: \"localhost:8080\"\n\n    AgentInfoSettingsUpdate:\n      type: object\n      required:\n        - download_dir\n        - supported_install_modes\n      properties:\n        download_dir:\n          type: string\n          example: \"/tmp/download\"\n        supported_install_modes:\n          type: array\n          items:\n            $ref: \"#/components/schemas/SupportedInstallMode\"\n\n    AgentInfoSettingsStorage:\n      type: object\n      required:\n        - read_only\n        - runtime_settings\n      properties:\n        read_only:\n          type: boolean\n        runtime_settings:\n          type: string\n          example: \"/data/updatehub/state.data\"\n\n    AgentInfoSettingsPolling:\n      type: object\n      required:\n        - enabled\n        - interval\n      properties:\n        enabled:\n          type: boolean\n        interval:\n          $ref: \"#/components/schemas/Duration\"\n\n    AgentInfoFirmware:\n      type: object\n      required:\n        - product_uid\n        - device_identity\n        - device_attributes\n        - hardware\n        - version\n      properties:\n        product_uid:\n          type: string\n          example: \"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\"\n        device_identity:\n          type: object\n          additionalProperties:\n            type: string\n          example:\n            id1: \"id1value1\"\n        device_attributes:\n          type: object\n          additionalProperties:\n            type: string\n          example:\n            attr1: \"attr1value1\"\n            attr2:\n              - \"attr2value1\"\n              - \"attr2value2\"\n        hardware:\n          type: string\n          example: \"board-name-revA\"\n        version:\n          type: string\n          example: \"1.2\"\n        pub_key:\n          type: string\n          example: \"/usr/share/updatehub/key.pub\"\n\n    AgentInfoRuntimeSettings:\n      type: object\n      required:\n        - polling\n        - update\n        - path\n        - persistent\n      properties:\n        polling:\n          $ref: \"#/components/schemas/AgentInfoRuntimeSettingsPolling\"\n        update:\n          $ref: \"#/components/schemas/AgentInfoRuntimeSettingsUpdate\"\n        path:\n          type: string\n          example: \"/data/updatehub/state.data\"\n        persistent:\n          type: boolean\n          example: true\n\n    AgentInfoRuntimeSettingsPolling:\n      type: object\n      required:\n        - last\n        - retries\n        - now\n        - server_address\n      properties:\n        last:\n          type: string\n          example: \"2017-01-01T00:00:00Z\"\n        retries:\n          type: integer\n        now:\n          type: boolean\n        server_address:\n          $ref: \"#/components/schemas/RuntimePollingServer\"\n\n    AgentInfoRuntimeSettingsUpdate:\n      type: object\n      properties:\n        upgrade_to_installation:\n          $ref: \"#/components/schemas/InstallationSet\"\n        applied_package_uid:\n          type: string\n          example: \"587f984393f04c63d8e0948ffcf3860500b1981b8496e5eb2a0d0f9a7ea356a5\"\n\n    Log:\n      type: object\n      required:\n        - entries\n      properties:\n        entries:\n          type: array\n          items:\n            $ref: \"#/components/schemas/LogEntry\"\n\n    LogEntry:\n      type: object\n      required:\n        - level\n        - message\n        - time\n        - data\n      properties:\n        level:\n          $ref: \"#/components/schemas/LogLevel\"\n        message:\n          type: string\n          example: \"info 1\"\n        time:\n          type: string\n          example: \"2017-06-29 14:59:41.831111065 -0300 -03\"\n        data:\n          type: object\n          additionalProperties:\n            type: string\n          example:\n            field1: \"value1\"\n            field2: \"value2\"\n\n    LogLevel:\n      type: string\n      enum: [\"error\", \"info\", \"warning\", \"debug\", \"trace\"]\n\n    SupportedInstallMode:\n      description: \"Available install modes\"\n      type: string\n      enum: [\"copy\", \"raw\"]\n\n    AgentState:\n      description: \"Agent state\"\n      type: string\n      enum: ['\"park\"', '\"entry_point\"', '\"poll\"', '\"probe\"', '\"validation\"', \n            '\"download\"', '\"install\"', '\"reboot\"', '\"direct_download\"',\n            '\"prepare_local_install\"', '\"error\"']\n\n    InstallationSet:\n      description: \"The partitions used for boot or installation\"\n      type: string\n      enum: [\"a\", \"b\"]\n\n    RuntimePollingServer:\n      description: |-\n        The server being used for the current running probe operation, if\n        default then the probe is being made to the server specified by the\n        agent settings. This can be non default when the user requests probe to\n        a different server.\n      oneOf:\n        - type: string\n          enum: [\"default\"]\n        - type: object\n          required:\n            - custom\n          properties:\n            custom:\n              type: string\n      example:\n        custom: \"http://localhost:8080\"\n\n    Duration:\n      type: string\n      description: |-\n        A integer followed by a letter to indicate the time unit\n      example: \"3600s\"\n",
			"canonicalURL": "/github.com/UpdateHub/updatehub@a8448a200f85ee6ba251b0d130ee2434fe018606/-/blob/doc/agent-http.yaml",
			"externalURLs": [
				{
					"url": "https://github.com/UpdateHub/updatehub/blob/a8448a200f85ee6ba251b0d130ee2434fe018606/doc/agent-http.yaml",
					"serviceKind": "GITHUB"
				}
			]
		}
	}
}